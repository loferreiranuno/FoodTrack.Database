version: '3'
services:
  foodtrack-db:
    image: ${IMAGE}
    ports: 
        - 5300:443
    restart: always 
    networks:
      - web
    labels:          
      - traefik.enable=true
      - traefik.http.middlewares.kcenar-database-redirect-websecure.redirectscheme.scheme=https
      - traefik.backend=foodtrack-db      
      - traefik.http.routers.kcenar-database.middlewares=kcenar-database-redirect-websecure
      - traefik.http.routers.kcenar-database.entrypoints=web
      - traefik.http.routers.kcenar-database.rule=Host(`db.kcenar.com`) || Host(`db.qcenar.com`)
      
      - traefik.http.routers.kcenar-database-websecure.rule=Host(`db.kcenar.com`) || Host(`db.qcenar.com`)
      - traefik.http.routers.kcenar-database-websecure.entrypoints=websecure
      - traefik.http.routers.kcenar-database-websecure.tls.certresolver=le
      - traefik.http.routers.kcenar-database-websecure.tls=true
      - traefik.docker.network=web
  foodtrack-postgres:
    image: postgres 
    restart: on-failure
    environment:
      - POSTGRES_USER=${POSTGRES_USER} 
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
      - PGDATA=/var/lib/postgresql/data/pgdata
      - POSTGRES_DB=foodtrack
    volumes:
      - ./postgres_data:/var/lib/postgresql
    ports:
      - 5432:5432
    networks:
      - web
networks:
  web:
    external: true
  internal:
    external: false